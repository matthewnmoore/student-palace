{% extends "base.html" %}
{% block title %}Photos – {{ house.title }}{% endblock %}
{% block content %}
<section class="wrap">
  <div class="flex-between" style="margin-bottom:12px">
    <h1 class="mt-0">Photos for “{{ house.title }}”</h1>
    <div class="inline-actions">
      <a class="btn" href="{{ url_for('landlord.landlord_houses') }}">Back to houses</a>
      <a class="btn btn-outline" href="{{ url_for('landlord.house_edit', hid=house.id) }}">Edit house</a>
      <a class="btn btn-outline" href="{{ url_for('landlord.rooms_list', hid=house.id) }}">Manage rooms</a>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="card">
    <h3 class="mt-0">Upload a photo</h3>
    <p class="help">Max {{ max_images }} per house. Max size 5&nbsp;MB. JPG/PNG/WebP/GIF accepted.</p>

    <form action="{{ url_for('landlord.house_photos', hid=house.id) }}"
          method="post" enctype="multipart/form-data"
          style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
      <input type="file" name="photo" accept="image/*" required>
      <button class="btn" type="submit">Upload</button>
    </form>
  </div>

  <div class="card" style="margin-top:14px;">
    <div class="flex-between" style="margin-bottom:10px; align-items:flex-end;">
      <h3 class="mt-0">Existing photos</h3>
      <div class="muted small">
        {% if images and images|length %}
          {{ images|length }} / {{ max_images }} uploaded
        {% else %}
          No photos yet — add one above.
        {% endif %}
      </div>
    </div>

    {% if images and images|length %}
      <ul style="list-style:none; padding:0; margin:0; display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:12px;">
        {% for img in images %}
          <li style="border:1px solid var(--border); border-radius:10px; overflow:hidden; background:#fff;">
            <!-- IMPORTANT: file_path is RELATIVE under /static -->
            <img src="{{ url_for('static', filename=img.file_path) }}" alt=""
                 style="width:100%; height:140px; object-fit:cover;">
            <div style="padding:8px; display:flex; gap:8px; justify-content:space-between; align-items:center;">
              {% if img.is_primary %}
                <span class="muted small">Primary</span>
              {% else %}
                <form method="post" action="{{ url_for('landlord.house_photos_primary', hid=house.id, img_id=img.id) }}">
                  <button class="btn btn-outline" type="submit">Make primary</button>
                </form>
              {% endif %}
              <form method="post"
                    action="{{ url_for('landlord.house_photos_delete', hid=house.id, img_id=img.id) }}"
                    onsubmit="return confirm('Delete this photo?');">
                <button class="btn btn-admin" type="submit">Delete</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">No photos yet.</p>
    {% endif %}
  </div>
</section>
{% endblock %}
