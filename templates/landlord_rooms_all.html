{% extends "base.html" %}
{% block title %}All rooms – Portfolio{% endblock %}
{% block content %}
<section class="wrap">
  <div class="flex-between" style="margin-bottom:12px">
    <h1 class="mt-0">Portfolio – all rooms</h1>
    <a class="btn btn-outline" href="{{ url_for('landlord.dashboard') }}">Back to dashboard</a>
  </div>

  <div class="card card--accent-lr">
    {% if rows and rows|length %}
      <table class="table portfolio-table">
        <thead>
          <tr>
            <th>House</th>
            <th>City</th>
            <th>Room</th>
            <th style="width:110px">£ PPM</th>
            <th style="width:110px">£ PPW</th>
            <th style="width:120px">Inclusive</th>
            <th style="width:220px">Availability</th>
            <th style="width:320px">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td class="nowrap"><strong>{{ r.house_title }}</strong></td>
            <td class="nowrap">{{ r.city }}</td>
            <td class="nowrap">{{ r.room_name }}</td>

            <td class="nowrap">
              {% if r.price_pcm %}
                £{{ r.price_pcm }}
              {% else %}
                —
              {% endif %}
            </td>
            <td class="nowrap">
              {% if r.price_pcm %}
                £{{ ((r.price_pcm * 12) // 52)|int }}
              {% else %}
                —
              {% endif %}
            </td>

            <td class="nowrap">
              {% set bi = (r.bills_option or 'no') %}
              {% if bi == 'yes' %}
                All bills
              {% elif bi == 'some' %}
                Some bills
              {% else %}
                —
              {% endif %}
            </td>

            <td class="nowrap">
              {% if not r.is_let %}
                Available now
              {% elif r.let_until %}
                {% set d = r.let_until %}
                {% if d and '-' in d and d|length >= 10 %}
                  Not until {{ d[8:10] }}/{{ d[5:7] }}/{{ d[0:4] }}
                {% else %}
                  Not until {{ d }}
                {% endif %}
              {% else %}
                Not available
              {% endif %}
            </td>

            <td>
              <div class="inline-actions actions-nowrap">
                <a class="btn" href="{{ url_for('landlord.room_photos', hid=r.house_id, rid=r.room_id) }}">Photos</a>
                <a class="btn btn-outline" href="{{ url_for('landlord.room_edit', hid=r.house_id, rid=r.room_id) }}">Edit</a>
                <a class="btn btn-outline" href="{{ url_for('landlord.rooms_list', hid=r.house_id) }}">House rooms</a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No rooms found.</p>
    {% endif %}
  </div>
</section>

<style>
  .portfolio-table .nowrap { white-space: nowrap; }
  .actions-nowrap {
    display:flex; gap:8px; align-items:center; white-space:nowrap; flex-wrap:nowrap;
  }
  /* Help keep cells on a single, tidy line on wider screens */
  @media (min-width: 860px) {
    .portfolio-table td, .portfolio-table th { vertical-align: middle; }
  }
  @media (max-width: 720px) {
    /* On small screens allow wrap where needed */
    .portfolio-table .nowrap { white-space: normal; }
  }
</style>
{% endblock %}
