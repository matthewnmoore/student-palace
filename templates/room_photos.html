{% extends "base.html" %}
{% block title %}Room photos – {{ house.title }} / {{ room.name }} – Student Palace{% endblock %}
{% block content %}
<section class="wrap">

  <!-- Header / breadcrumbs -->
  <div class="card card--accent-edges" style="margin-top:12px">
    <div class="flex-between">
      <div>
        <h2 class="mt-0" style="margin-bottom:6px">Room photos</h2>
        <p class="small" style="margin:0">
          <strong>House:</strong> {{ house.title }} (ID {{ house.id }}) &nbsp;•&nbsp;
          <strong>Room:</strong> {{ room.name }} (ID {{ room.id }})
        </p>
      </div>
      <div class="inline-actions">
        <a class="btn btn-outline" href="{{ url_for('landlord.rooms_list', hid=house.id) }}">Back to rooms</a>
        <a class="btn btn-outline" href="{{ url_for('landlord.house_edit', hid=house.id) }}">Back to house</a>
      </div>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Upload -->
  <div class="card card--accent-edges">
    <h3 class="mt-0">Upload a new photo</h3>
    <form method="post" enctype="multipart/form-data" action="{{ url_for('landlord.room_photos_upload', hid=house.id, rid=room.id) }}">
      <div class="grid grid-2">
        <label class="field" style="grid-column:1 / -1">
          <span class="label">Choose image (JPEG/PNG/WebP/GIF, up to 5 MB)</span>
          <input type="file" name="file" accept="image/*" required>
        </label>
      </div>
      <p class="help" style="margin-top:6px">We automatically resize and add a small “Student Palace” watermark.</p>
      <button class="btn" type="submit" style="margin-top:10px">Upload photo</button>
    </form>
  </div>

  <!-- Current images -->
  <div class="card card--accent-edges" style="margin-top:12px">
    <h3 class="mt-0">Current photos</h3>

    {% if images and images|length %}
      <div class="grid grid-3">
        {% for img in images %}
          <div class="card" style="padding:12px; margin:0">
            <div style="aspect-ratio: 4 / 3; width:100%; overflow:hidden; border-radius:8px; border:1px solid var(--border); display:flex; align-items:center; justify-content:center;">
              <img
                src="{{ url_for('static', filename=img.file_path) }}"
                alt="Room photo {{ loop.index }}"
                style="max-width:100%; max-height:100%; display:block;">
            </div>

            <p class="small" style="margin:8px 0 0">
              {{ img.width }}×{{ img.height }} • {{ (img.bytes / 1024)|round(0) }} KB
            </p>
            <p class="small" style="margin:2px 0 8px; color: var(--muted);">
              Uploaded: {{ img.created_at }}
            </p>

            {% if img.is_primary %}
              <span class="badge">Primary</span>
            {% endif %}

            <form method="post" action="{{ url_for('landlord.room_photos_set_primary', hid=house.id, rid=room.id, img_id=img.id) }}" style="display:inline-block; margin-top:8px">
              <button class="btn btn-outline" type="submit" {% if img.is_primary %}disabled{% endif %}>Set primary</button>
            </form>

            <form method="post" action="{{ url_for('landlord.room_photos_delete', hid=house.id, rid=room.id, img_id=img.id) }}" style="display:inline-block; margin-top:8px">
              <button class="btn btn-outline" type="submit" onclick="return confirm('Delete this photo?')">Delete</button>
            </form>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="help">No photos yet. Upload your first one above.</p>
    {% endif %}
  </div>

</section>
{% endblock %}
