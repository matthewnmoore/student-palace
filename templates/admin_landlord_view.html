{% extends "base.html" %}
{% block title %}Admin: Landlord {{ landlord.id if landlord else '' }} â€“ Student Palace{% endblock %}
{% block content %}
<section class="wrap">
  <h1>Landlord detail</h1>

  {% if not landlord %}
    <div class="card"><p>Landlord not found.</p></div>
    <p><a class="btn" href="{{ url_for('admin.admin_landlords') }}">Back</a></p>
  {% else %}

  <div class="grid grid-2">
    <!-- Account & access controls (compact, inline) -->
    <div class="card">
      <h3 class="mt-0">Account & access</h3>

      <!-- Email update -->
      <form method="post" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
        <input type="hidden" name="action" value="update_email">
        <label class="field" style="margin:0">
          <span class="label">Email</span>
          <input type="email" name="email" value="{{ landlord.email }}"
                 style="padding:8px; border:1px solid var(--border); border-radius:8px; min-width:260px">
        </label>
        <button class="btn" type="submit">Update email</button>
      </form>

      <!-- Password reset -->
      <form method="post" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px">
        <input type="hidden" name="action" value="reset_password">
        <label class="field" style="margin:0">
          <span class="label">New password</span>
          <input type="text" name="new_password" placeholder="Leave blank to auto-generate"
                 style="padding:8px; border:1px solid var(--border); border-radius:8px; min-width:260px">
        </label>
        <button class="btn" type="submit">Reset password</button>
      </form>

      <!-- Verification toggle -->
      <form method="post" style="display:flex; gap:12px; align-items:center; margin-top:12px">
        <input type="hidden" name="action" value="set_verified">
        <label style="display:flex; gap:8px; align-items:center; margin:0">
          <input type="checkbox" name="is_verified" {% if profile and (profile.is_verified|default(0, true)) %}checked{% endif %}>
          <span>Verified landlord/agent</span>
        </label>
        <button class="btn" type="submit">Save</button>
      </form>

      <!-- Danger zone -->
      <form method="post" style="margin-top:14px"
            onsubmit="return confirm('Delete this landlord and their profile? This cannot be undone.');">
        <input type="hidden" name="action" value="delete_landlord">
        <button class="btn btn-admin" type="submit">Delete landlord</button>
      </form>

      <p class="help" style="margin-top:10px">
        Created: {{ landlord.created_at }}
      </p>
    </div>

    <!-- Profile panel -->
    <div class="card">
      <h3 class="mt-0">Profile</h3>
      <form method="post" style="display:grid; gap:10px">
        <input type="hidden" name="action" value="update_profile">

        <label class="field" style="margin:0">
          <span class="label">Display name</span>
          <input type="text" name="display_name" value="{{ profile.display_name if profile else '' }}"
                 style="padding:8px; border:1px solid var(--border); border-radius:8px">
        </label>

        <div class="grid grid-2">
          <label class="field" style="margin:0">
            <span class="label">Phone</span>
            <input type="text" name="phone" value="{{ profile.phone if profile else '' }}"
                   style="padding:8px; border:1px solid var(--border); border-radius:8px">
          </label>
          <label class="field" style="margin:0">
            <span class="label">Website</span>
            <input type="url" name="website" value="{{ profile.website if profile else '' }}"
                   style="padding:8px; border:1px solid var(--border); border-radius:8px">
          </label>
        </div>

        <label class="field" style="margin:0">
          <span class="label">Bio</span>
          <textarea name="bio" rows="5"
                    style="padding:8px; border:1px solid var(--border); border-radius:8px">{{ profile.bio if profile else '' }}</textarea>
        </label>

        <div class="inline-actions" style="margin-top:6px">
          <button class="btn" type="submit">Save profile</button>
          {% if profile and profile.public_slug %}
            <a class="btn btn-outline" href="/l/{{ profile.public_slug }}" target="_blank" rel="noopener">View public page</a>
          {% endif %}
        </div>
      </form>
    </div>
  </div>

  <!-- Properties list -->
  <div class="card" style="margin-top:16px">
    <h3 class="mt-0">Properties</h3>
    {% if houses and houses|length %}
      <table class="table" style="margin-top:8px">
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>City</th>
            <th>Letting type</th>
            <th>Bedrooms</th>
          </tr>
        </thead>
        <tbody>
          {% for h in houses %}
            <tr>
              <td>{{ h.id }}</td>
              <td>{{ h.title }}</td>
              <td>{{ h.city }}</td>
              <td>{{ 'Whole' if h.letting_type=='whole' else 'Share' }}</td>
              <td>{{ h.bedrooms_total }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No properties yet.</p>
    {% endif %}
  </div>

  <p style="margin-top:12px">
    <a class="btn" href="{{ url_for('admin.admin_landlords') }}">Back to list</a>
    <a class="btn btn-outline" href="{{ url_for('admin.admin_logout') }}">Admin log out</a>
  </p>

  {% endif %}
</section>
{% endblock %}
