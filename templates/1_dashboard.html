{% extends "base.html" %}
{% block title %}Dashboard – Student Palace{% endblock %}
{% block content %}
<section class="wrap">
  <div class="flex-between" style="margin-bottom:12px">
    <h1 class="mt-0">Landlord dashboard</h1>
    {% if landlord %}
      <a class="btn" href="{{ url_for('landlord.landlord_houses') }}">Manage houses</a>
    {% endif %}
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% if not landlord %}
    <div class="card card--accent-lr">
      <p class="mt-0">You’re not logged in.</p>
      <p style="margin-top:10px">
        <a class="btn" href="{{ url_for('auth.login') }}">Log in</a>
        <a class="btn btn-outline" href="{{ url_for('auth.signup') }}">Create an account</a>
      </p>
    </div>
  {% else %}

    <div class="grid grid-2">
      <!-- Account -->
      <div class="card card--accent-lr">
        <h3 class="mt-0">Account</h3>
        <p><strong>{{ landlord.email }}</strong></p>
        {% if created_at_uk %}
          <p class="small">Member since: {{ created_at_uk }}</p>
        {% endif %}
        {% if role_label %}
          <p class="small">Role: {{ role_label }}</p>
        {% endif %}
        <p style="margin-top:10px">
          <a class="btn btn-outline" href="{{ url_for('landlord.landlord_profile') }}">Edit profile</a>
        </p>
      </div>

      <!-- Quick actions (two per row) -->
      <div class="card card--accent-lr">
        <h3 class="mt-0">Quick actions</h3>
        <div class="qa-grid">
          <!-- Row 1 -->
          <a class="btn" href="{{ url_for('landlord.house_new') }}">Add a new house</a>
          <a class="btn btn-outline" href="{{ url_for('landlord.landlord_houses') }}">Manage houses</a>

<!-- Row 2 -->
<a class="btn btn-outline" href="{{ url_for('landlord.portfolio') }}">Portfolio</a>
<span></span> <!-- spacer to keep two-per-row layout -->



          
        

          <!-- Row 3 -->
          <a class="btn" href="{{ url_for('landlord.rooms_portfolio_edit') }}">Bulk rooms edit</a>
          <a class="btn btn-outline" href="{{ url_for('landlord.bulk_edit') }}">Bulk house edit</a>
        </div>
      </div>
    </div>

    <!-- Houses table -->
    <div class="card card--accent-lr" style="margin-top:14px">
      <h3 class="mt-0">Your houses</h3>
      {% if houses and houses|length %}
        <table class="table" style="margin:0">
          <thead>
            <tr>
              <th style="width:68px">ID</th>
              <th>Title</th>
              <th>City</th>
              <th>Letting</th>
              <th style="width:160px">Availability</th>
              <th style="width:520px">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for h in houses %}
              <tr>
                <td>{{ h.id }}</td>
                <td><strong>{{ h.title }}</strong></td>
                <td>{{ h.city }}</td>
                <td>{{ 'Whole' if h.letting_type=='whole' else 'Share' }}</td>
                <td>{{ h.bedrooms_total or 0 }} / {{ h.available_rooms_total or 0 }}</td>
                <td>
                  <div class="inline-actions actions-nowrap">
                    <a class="btn" href="{{ url_for('landlord.rooms_list', hid=h.id) }}">Rooms</a>
                    <a class="btn btn-outline" href="{{ url_for('landlord.house_edit', hid=h.id) }}">Edit</a>
                    <a class="btn btn-outline" href="{{ url_for('landlord.house_photos', hid=h.id) }}">Photos</a>
                    <a class="btn btn-outline" href="{{ url_for('landlord.house_floorplans', hid=h.id) }}">Floor plans</a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted">No houses yet.</p>
      {% endif %}
    </div>

  {% endif %}
</section>

<style>
  /* Quick actions: exactly two buttons per row on desktop, one per row on narrow screens */
  .qa-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(180px, 1fr));
    gap: 10px;
  }
  .qa-grid > span { display:block; } /* spacer cell */

  @media (max-width: 720px) {
    .qa-grid { grid-template-columns: 1fr; }
    .qa-grid > span { display:none; }
  }

  /* Keep action buttons on a single line and prevent wrap */
  .actions-nowrap {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
    align-items: center;
    white-space: nowrap;
  }
</style>
{% endblock %}
