{% extends "base.html" %}
{% block title %}Admin – Backup{% endblock %}

{% block content %}
<div class="wrap">
  <div class="card card--accent-l">
    <h1 style="margin-bottom:8px;">Manual Backup</h1>
    <p class="help">Creates a compressed archive of <code>/static/uploads</code> and uploads it to Dropbox.</p>
  </div>

  {# Flash messages (maps Flask categories to your CSS) #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="wrap" style="padding:0">
        {% for category, message in messages %}
          {% set css_cat = 'error' if category in ['danger','error'] else ('success' if category in ['ok','success'] else category) %}
          <div class="flash {{ css_cat }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="card">
    <form method="post" class="grid" onsubmit="this.querySelector('button').disabled=true;">
      <button type="submit" class="btn btn-admin">Back up now</button>
      <p class="help" style="margin-top:6px;">This may take a minute if there are lots of images.</p>
    </form>
  </div>

  {% if result %}
    <div class="card">
      <p><strong>Last backup:</strong> <code>{{ result }}</code></p>
    </div>
  {% endif %}

  <p style="margin-top:10px">
    <a href="{{ url_for('admin.dashboard') }}">← Back to admin</a>
  </p>
</div>
{% endblock %}
