{% extends "base.html" %}
{% block title %}{{ 'Add house' if mode=='new' else 'Edit house' }} – Student Palace{% endblock %}

{% block content %}
<section class="wrap">
  <h1>{{ 'Add a house' if mode=='new' else 'Edit house' }}</h1>

  <div class="grid grid-2">
    <!-- Main form -->
    <form method="post" class="card" style="grid-column:1 / 2">
      <div class="grid grid-2">
        <!-- Title -->
        <label class="field">
          <span class="label">Title</span>
          <input type="text" name="title" value="{{ (form.title or '') if form else '' }}" required>
        </label>

        <!-- City -->
        <label class="field">
          <span class="label">City</span>
          <select name="city" required>
            <option value="">Select a city</option>
            {% for c in cities %}
              <option value="{{ c }}" {% if form and form.city==c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
          <p class="help">Only admin-listed cities are available.</p>
        </label>

        <!-- Address -->
        <label class="field" style="grid-column:1 / -1">
          <span class="label">Address</span>
          <input type="text" name="address" value="{{ (form.address or '') if form else '' }}" required>
        </label>

        <!-- Letting type -->
        <label class="field">
          <span class="label">Letting type</span>
          <select name="letting_type" required>
            <option value="whole" {% if form and form.letting_type=='whole' %}selected{% endif %}>Whole property</option>
            <option value="share" {% if form and form.letting_type=='share' %}selected{% endif %}>House share (rooms)</option>
          </select>
        </label>

        <!-- Bedrooms total -->
        <label class="field">
          <span class="label">Bedrooms (total)</span>
          <input type="number" name="bedrooms_total" min="1" value="{{ (form.bedrooms_total or 1) if form else 1 }}" required>
        </label>

        <!-- Gender preference -->
        <label class="field">
          <span class="label">House identifies as</span>
          <select name="gender_preference" required>
            {% for g in ['Either','Male','Female','Mixed'] %}
              <option value="{{ g }}" {% if form and form.gender_preference==g %}selected{% endif %}>{{ g }}</option>
            {% endfor %}
          </select>
        </label>

        <!-- Bills included -->
        <label class="field" style="align-self:end">
          <input type="checkbox" name="bills_included" {% if form and form.bills_included in ['1',1,'on',True] %}checked{% endif %}>
          <span class="label-inline">Bills included</span>
        </label>
      </div>

      <!-- Bathrooms -->
      <h3 style="margin-top:14px">Bathrooms</h3>
      <div class="grid">
        <label class="field">
          <span class="label">Shared bathrooms (number)</span>
          <input type="number" name="shared_bathrooms" min="0" value="{{ (form.shared_bathrooms or 0) if form else 0 }}">
        </label>
      </div>

      <!-- House info (non-searchable) -->
      <h3 style="margin-top:14px">House info (not searchable)</h3>
      <div class="grid grid-3">
        <label class="field checkbox">
          <input type="checkbox" name="off_street_parking" {% if form and form.off_street_parking in ['1',1,'on',True] %}checked{% endif %}>
          <span>Off-street parking available</span>
        </label>

        <label class="field checkbox">
          <input type="checkbox" name="local_parking" {% if form and form.local_parking in ['1',1,'on',True] %}checked{% endif %}>
          <span>Local parking available</span>
        </label>

        <label class="field checkbox">
          <input type="checkbox" name="cctv" {% if form and form.cctv in ['1',1,'on',True] %}checked{% endif %}>
          <span>CCTV</span>
        </label>

        <label class="field checkbox">
          <input type="checkbox" name="video_door_entry" {% if form and form.video_door_entry in ['1',1,'on',True] %}checked{% endif %}>
          <span>Video door entry</span>
        </label>

        <label class="field checkbox">
          <input type="checkbox" name="bike_storage" {% if form and form.bike_storage in ['1',1,'on',True] %}checked{% endif %}>
          <span>Bike storage</span>
        </label>

        <label class="field">
          <span class="label">Cleaning service</span>
          <select name="cleaning_service">
            {% for cs in ['none','weekly','fortnightly','monthly'] %}
              <option value="{{ cs }}" {% if form and form.cleaning_service==cs %}selected{% endif %}>
                {{ 'None' if cs=='none' else cs|capitalize }}
              </option>
            {% endfor %}
          </select>
          <p class="help">If “None”, we won’t show cleaning info on the property page.</p>
        </label>

        <label class="field checkbox">
          <input type="checkbox" name="wifi" {% if (not form) or form.wifi in ['1',1,'on',True] %}checked{% endif %}>
          <span>Wi-Fi</span>
        </label>

        <label class="field checkbox">
          <input type="checkbox" name="wired_internet" {% if form and form.wired_internet in ['1',1,'on',True] %}checked{% endif %}>
          <span>Wired internet</span>
        </label>

        <label class="field checkbox">
          <input type="checkbox" name="common_area_tv" {% if form and form.common_area_tv in ['1',1,'on',True] %}checked{% endif %}>
          <span>Common area TV</span>
        </label>
      </div>

      <!-- Actions -->
      <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" type="submit">{{ 'Create house' if mode=='new' else 'Save changes' }}</button>
        <a class="btn btn-outline" href="{{ url_for('landlord_houses') }}">Cancel</a>
      </div>
    </form>

    <!-- Side tools (only when editing an existing house) -->
    <aside style="grid-column:2 / 3; display:flex; flex-direction:column; gap:14px">
      {% if mode!='new' and house %}
        <div class="card">
          <h3 class="mt-0">Photos</h3>
          <p class="help">Up to 5 images. You’ll be able to delete or rotate later.</p>
          <a class="btn" href="{{ url_for('landlord_images', scope='house', house_id=house.id) if 'landlord_images' in current_app.view_functions else '#' }}"
             {% if 'landlord_images' not in current_app.view_functions %}onclick="alert('Photos manager will be added in the next step.'); return false;"{% endif %}>
            Manage photos
          </a>
        </div>

        <div class="card">
          <h3 class="mt-0">Rooms</h3>
          <p class="help">Add and manage rooms for this property.</p>
          <div class="inline-actions" style="flex-wrap:wrap">
            <a class="btn"
               href="{{ url_for('room_new', house_id=house.id) if 'room_new' in current_app.view_functions else '#' }}"
               {% if 'room_new' not in current_app.view_functions %}onclick="alert('Rooms will be added in the next step.'); return false;"{% endif %}>
              Add a room
            </a>
            <a class="btn btn-outline"
               href="{{ url_for('rooms_list', house_id=house.id) if 'rooms_list' in current_app.view_functions else '#' }}"
               {% if 'rooms_list' not in current_app.view_functions %}onclick="alert('Rooms list will be added in the next step.'); return false;"{% endif %}>
              View rooms
            </a>
          </div>
        </div>
      {% else %}
        <div class="card">
          <h3 class="mt-0">Next steps</h3>
          <p class="help">Save the house first. You’ll then be able to upload photos and add rooms.</p>
        </div>
      {% endif %}
    </aside>
  </div>
</section>
{% endblock %}
