{% extends "base.html" %}
{% block title %}Dashboard – Student Palace{% endblock %}
{% block content %}
<section class="wrap">
  <div class="flex-between" style="margin-bottom:12px">
    <h1 class="mt-0">Landlord dashboard</h1>
    {% if landlord %}
      <a class="btn" href="{{ url_for('landlord.landlord_houses') }}">Manage houses</a>
    {% endif %}
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% if not landlord %}
    <div class="card card--accent-lr">
      <p class="mt-0">You’re not logged in.</p>
      <p style="margin-top:10px">
        <a class="btn" href="{{ url_for('auth.login') }}">Log in</a>
        <a class="btn btn-outline" href="{{ url_for('auth.signup') }}">Create an account</a>
      </p>
    </div>
  {% else %}

    <div class="grid grid-2">
      <!-- Account card -->
      <div class="card card--accent-lr">
        <h3 class="mt-0">Account</h3>
        <p><strong>{{ landlord.email }}</strong></p>
        {% if created_at_uk %}
          <p class="small">Member since: {{ created_at_uk }}</p>
        {% endif %}
        {% if role_label %}
          <p class="small">Role: {{ role_label }}</p>
        {% endif %}
        <p style="margin-top:10px">
          <a class="btn btn-outline" href="{{ url_for('landlord.landlord_profile') }}">Edit profile</a>
        </p>
      </div>

      <!-- Quick actions -->
      <div class="card card--accent-lr">
        <h3 class="mt-0">Quick actions</h3>
        <div class="inline-actions" style="display:flex; gap:10px; flex-wrap:wrap">
          <a class="btn" href="{{ url_for('landlord.house_new') }}">Add a new house</a>
          <a class="btn btn-outline" href="{{ url_for('landlord.landlord_houses') }}">Manage houses</a>
          <!-- NEW: all rooms across all houses -->
          <a class="btn btn-outline" href="{{ url_for('landlord.rooms_all') }}">All rooms</a>
        </div>
      </div>
    </div>

    <!-- Your houses -->
    <div class="card card--accent-lr" style="margin-top:14px">
      <h3 class="mt-0">Your houses</h3>

      {% if houses and houses|length %}
        <table class="table" style="margin:0">
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>City</th>
              <th>Letting</th>
              <th>Beds</th>
              <th style="width:360px">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for h in houses %}
              <tr>
                <td>{{ h.id }}</td>
                <td>
                  <strong>{{ h.title }}</strong>
                  {% if is_verified %}
                    <span class="badge" style="margin-left:6px">Verified</span>
                  {% endif %}
                </td>
                <td>{{ h.city }}</td>
                <td>{{ 'Whole' if h.letting_type=='whole' else 'Share' }}</td>
                <td>{{ h.bedrooms_total }}</td>
                <td>
                  <div class="inline-actions" style="display:flex; gap:8px; align-items:center;">
                    <a class="btn" href="{{ url_for('landlord.rooms_list', hid=h.id) }}">Rooms</a>
                    <a class="btn btn-outline" href="{{ url_for('landlord.house_edit', hid=h.id) }}">Edit</a>
                    <a class="btn btn-outline" href="{{ url_for('landlord.house_photos', hid=h.id) }}">Photos</a>
                    <a class="btn btn-outline" href="{{ url_for('landlord.house_floorplans', hid=h.id) }}">Floor plans</a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted">No houses yet.</p>
      {% endif %}
    </div>

  {% endif %}
</section>
{% endblock %}
